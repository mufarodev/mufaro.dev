---
import { cn } from "../utils";

const routes = [
  { name: "Home", path: "/" },
  { name: "Projects", path: "/projects" },
  { name: "Blog", path: "/blog" },
  { name: "Experience", path: "/experience" }
];

const currentPath = Astro.url.pathname;
---

<div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 w-auto">
  <div class="relative">
    <!-- glow -->
    <div class="absolute inset-0 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-pink-500/20 rounded-full blur-xl opacity-50"></div>
    
    <!-- glass -->
    <nav id="nav-container" class="relative backdrop-blur-lg bg-black/40 border border-white/10 rounded-full px-1.5 py-1.5 flex items-center shadow-xl">
      <!-- grain -->
      <div class="absolute inset-0 rounded-full opacity-10" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIiB4PSIwIiB5PSIwIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iLjc1IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMSAwIDAgMCAwIDEgMCAwIDAgMCAxIDAgMCAwIDAuNSAwIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIGZpbHRlcj0idXJsKCNhKSIvPjwvc3ZnPg==');"></div>
      
      <!-- <div id="nav-indicator" class="absolute top-1/2 -translate-y-1/2 h-[calc(100%-10px)] bg-gradient-to-r from-indigo-500/40 to-purple-500/40 rounded-full transition-all duration-300 ease-out shadow-[0_0_12px_rgba(168,85,247,0.4)]" transition:persist></div> -->
      <div id="nav-indicator" class="absolute top-1/2 -translate-y-1/2 h-[calc(100%-10px)]  backdrop-blur-sm border-2 border-white/10 rounded-full transition-all duration-300 ease-out" transition:persist>
          <!-- Gradient border using pseudo-element -->
        <div class="absolute -inset-[1px] bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10 rounded-full -z-10 blur-sm opacity-50"></div>
  
        <!-- Inner shadow glow -->
        <div class="absolute inset-0 rounded-full shadow-[inset_0_0_8px_rgba(255,255,255,0.1)]"></div>
        
        <!-- grain -->
        <div class="absolute inset-0 rounded-full opacity-20" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIiB4PSIwIiB5PSIwIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iLjc1IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMSAwIDAgMCAwIDEgMCAwIDAgMCAxIDAgMCAwIDAuNSAwIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIGZpbHRlcj0idXJsKCNhKSIvPjwvc3ZnPg==');"></div>
      </div>

      {routes.map((route, idx) => (
        <a 
          href={route.path}
          data-path={route.path}
          data-index={idx}
          data-active={currentPath === route.path}
          class={cn(
            "nav-link relative px-4 rounded-full text-sm font-medium transition-colors duration-300 mx-1",
            currentPath === route.path 
              ? "text-white hover:text-white" 
              : "text-white/70 hover:text-white"
          )}
        >
          <span class="relative z-10">{route.name}</span>
        </a>
      ))}
      
      <button class="ml-2 p-1.5 bg-white/5 rounded-full hover:bg-white/10 transition-all hidden md:flex">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="text-white/70" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
      </button>
    </nav>
  </div>
</div>

<script>
  function positionIndicator() {
    const activeLink = document.querySelector('.nav-link[data-path="' + window.location.pathname + '"]') || 
                      document.querySelector('.nav-link[data-index="0"]');
    
    if (activeLink) {
      const indicator = document.getElementById('nav-indicator') as HTMLDivElement;
      const padding = 2;
      
      indicator.style.left = `${activeLink.offsetLeft - padding}px`;
      indicator.style.width = `${activeLink.offsetWidth + padding * 2}px`;
    }
  }

  positionIndicator();
  
  // view transition support
  document.addEventListener('astro:page-load', () => {
    positionIndicator();
  });
  
  // immiediately update indicator on click
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const indicator = document.getElementById('nav-indicator') as HTMLDivElement;
      const padding = 2;
      
      indicator.style.left = `${e.currentTarget?.offsetLeft - padding}px`;
      indicator.style.width = `${e.currentTarget?.offsetWidth + padding * 2}px`;
    });
  });
  
  // Handle window resize
  window.addEventListener('resize', positionIndicator);
</script>

<style>
  a {
    text-decoration: none;
    transition: all 0.2s ease-out;
  }
  
  a:hover[data-active="false"] {
    transform: translateY(-1px);
  }
  
  a:active {
    transform: translateY(0);
  }
  
  #nav-indicator {
    backdrop-filter: blur(4px);
    box-shadow: 0 0 10px rgba(139, 92, 246, 0.07);
  }
</style>